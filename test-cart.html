<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Firebase Test - TARG STAR</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }
        
        h1 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #FFD700;
        }
        
        .btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .btn.danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }
        
        .btn.success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result.success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
        }
        
        .result.error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
        }
        
        .result.info {
            background: rgba(23, 162, 184, 0.2);
            border: 1px solid #17a2b8;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
        }
        
        .cart-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .quantity-btn {
            background: #FFD700;
            color: black;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #FFD700;
            text-decoration: none;
            font-weight: 600;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí Cart Firebase Integration Test</h1>
        
        <!-- Status Dashboard -->
        <div class="test-section">
            <h3>Cart Status</h3>
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-value" id="cart-count-display">0</div>
                    <div>Items in Cart</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="cart-total-display">$0.00</div>
                    <div>Cart Total</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="firebase-status">‚ùå</div>
                    <div>Firebase Status</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="sync-status">‚è≥</div>
                    <div>Sync Status</div>
                </div>
            </div>
        </div>
        
        <!-- Cart Operations -->
        <div class="test-section">
            <h3>Cart Operations</h3>
            <button class="btn" onclick="addTestItem()">Add Test Course</button>
            <button class="btn" onclick="addMultipleItems()">Add Multiple Items</button>
            <button class="btn" onclick="showCartContents()">Show Cart Contents</button>
            <button class="btn" onclick="getCartAnalytics()">Get Analytics</button>
            <button class="btn danger" onclick="clearCart()">Clear Cart</button>
            <div id="cart-results"></div>
        </div>
        
        <!-- Firebase Operations -->
        <div class="test-section">
            <h3>Firebase Operations</h3>
            <button class="btn" onclick="testFirebaseSync()">Test Firebase Sync</button>
            <button class="btn" onclick="loadFromFirebase()">Load from Firebase</button>
            <button class="btn" onclick="saveToFirebase()">Save to Firebase</button>
            <button class="btn" onclick="checkCartStatus()">Check Status</button>
            <div id="firebase-results"></div>
        </div>
        
        <!-- Cart Display -->
        <div class="test-section">
            <h3>Current Cart Items</h3>
            <div id="cart-display">
                <p>No items in cart</p>
            </div>
        </div>
        
        <!-- Authentication Test -->
        <div class="test-section">
            <h3>Authentication Test</h3>
            <button class="btn" onclick="testLogin()">Test Login</button>
            <button class="btn" onclick="testLogout()">Test Logout</button>
            <div id="auth-status">Not logged in</div>
        </div>
        
        <a href="cart.html" class="back-link">‚Üê Back to Cart Page</a>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-simple.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart-firebase.js"></script>
    
    <script>
        // Test data
        const testCourses = [
            { id: 'ml-course', name: 'Machine Learning Fundamentals', price: 199, image: 'images/ml.jpg' },
            { id: 'nlp-course', name: 'Natural Language Processing', price: 249, image: 'images/nlp.jpg' },
            { id: 'dl-course', name: 'Deep Learning Mastery', price: 299, image: 'images/dl.jpg' },
            { id: 'cv-course', name: 'Computer Vision Basics', price: 179, image: 'images/cv.jpg' },
            { id: 'ai-ethics', name: 'AI Ethics Course', price: 79, image: 'images/ethics.jpg' }
        ];
        
        // Test functions
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
            
            // Auto-scroll to bottom
            resultDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Remove old results (keep only last 3)
            const results = container.querySelectorAll('.result');
            if (results.length > 3) {
                results[0].remove();
            }
        }
        
        function updateStatusDisplay() {
            if (!window.cartManager) return;
            
            const status = window.cartManager.getStatus();
            
            document.getElementById('cart-count-display').textContent = status.itemCount;
            document.getElementById('cart-total-display').textContent = `$${status.totalValue.toFixed(2)}`;
            document.getElementById('firebase-status').textContent = status.firebaseReady ? '‚úÖ' : '‚ùå';
            document.getElementById('sync-status').textContent = status.syncInProgress ? 'üîÑ' : '‚úÖ';
            
            // Update auth status
            const authStatus = document.getElementById('auth-status');
            if (status.userAuthenticated) {
                const user = window.authManager?.getCurrentUser();
                authStatus.textContent = `Logged in as: ${user?.displayName || user?.email || 'Unknown'}`;
                authStatus.style.color = '#28a745';
            } else {
                authStatus.textContent = 'Not logged in';
                authStatus.style.color = '#dc3545';
            }
        }
        
        function addTestItem() {
            if (!window.cartManager) {
                showResult('cart-results', 'Cart manager not ready', 'error');
                return;
            }
            
            const randomCourse = testCourses[Math.floor(Math.random() * testCourses.length)];
            window.cartManager.addToCart(randomCourse);
            
            showResult('cart-results', `Added: ${randomCourse.name} ($${randomCourse.price})`, 'success');
            updateStatusDisplay();
            updateCartDisplay();
        }
        
        function addMultipleItems() {
            if (!window.cartManager) {
                showResult('cart-results', 'Cart manager not ready', 'error');
                return;
            }
            
            testCourses.slice(0, 3).forEach(course => {
                window.cartManager.addToCart(course);
            });
            
            showResult('cart-results', 'Added 3 test courses to cart', 'success');
            updateStatusDisplay();
            updateCartDisplay();
        }
        
        function showCartContents() {
            if (!window.cartManager) {
                showResult('cart-results', 'Cart manager not ready', 'error');
                return;
            }
            
            const cart = window.cartManager.getCart();
            const cartInfo = cart.map(item => 
                `${item.name} (Qty: ${item.quantity}, Price: $${item.price})`
            ).join('\n');
            
            showResult('cart-results', 
                cart.length > 0 ? `Cart Contents:\n${cartInfo}` : 'Cart is empty', 
                cart.length > 0 ? 'info' : 'error'
            );
        }
        
        function getCartAnalytics() {
            if (!window.cartManager) {
                showResult('cart-results', 'Cart manager not ready', 'error');
                return;
            }
            
            const analytics = window.cartManager.getCartAnalytics();
            const analyticsInfo = JSON.stringify(analytics, null, 2);
            
            showResult('cart-results', `Cart Analytics:\n${analyticsInfo}`, 'info');
        }
        
        function clearCart() {
            if (!window.cartManager) {
                showResult('cart-results', 'Cart manager not ready', 'error');
                return;
            }
            
            window.cartManager.clearCart();
            showResult('cart-results', 'Cart cleared successfully', 'success');
            updateStatusDisplay();
            updateCartDisplay();
        }
        
        function testFirebaseSync() {
            if (!window.cartManager) {
                showResult('firebase-results', 'Cart manager not ready', 'error');
                return;
            }
            
            showResult('firebase-results', 'Testing Firebase sync...', 'info');
            
            window.cartManager.syncWithFirebase().then(() => {
                showResult('firebase-results', 'Firebase sync completed', 'success');
                updateStatusDisplay();
            }).catch(error => {
                showResult('firebase-results', `Firebase sync failed: ${error.message}`, 'error');
            });
        }
        
        function loadFromFirebase() {
            if (!window.cartManager) {
                showResult('firebase-results', 'Cart manager not ready', 'error');
                return;
            }
            
            showResult('firebase-results', 'Loading cart from Firebase...', 'info');
            
            window.cartManager.loadCartFromFirebase().then(cart => {
                if (cart) {
                    showResult('firebase-results', `Loaded ${cart.length} items from Firebase`, 'success');
                } else {
                    showResult('firebase-results', 'No cart data found in Firebase', 'info');
                }
                updateStatusDisplay();
                updateCartDisplay();
            }).catch(error => {
                showResult('firebase-results', `Load failed: ${error.message}`, 'error');
            });
        }
        
        function saveToFirebase() {
            if (!window.cartManager) {
                showResult('firebase-results', 'Cart manager not ready', 'error');
                return;
            }
            
            showResult('firebase-results', 'Saving cart to Firebase...', 'info');
            
            window.cartManager.saveCartToFirebase().then(success => {
                if (success) {
                    showResult('firebase-results', 'Cart saved to Firebase successfully', 'success');
                } else {
                    showResult('firebase-results', 'Failed to save cart to Firebase', 'error');
                }
            }).catch(error => {
                showResult('firebase-results', `Save failed: ${error.message}`, 'error');
            });
        }
        
        function checkCartStatus() {
            if (!window.cartManager) {
                showResult('firebase-results', 'Cart manager not ready', 'error');
                return;
            }
            
            const status = window.cartManager.getStatus();
            const statusInfo = JSON.stringify(status, null, 2);
            
            showResult('firebase-results', `Cart Status:\n${statusInfo}`, 'info');
        }
        
        function updateCartDisplay() {
            const container = document.getElementById('cart-display');
            
            if (!window.cartManager) {
                container.innerHTML = '<p>Cart manager not ready</p>';
                return;
            }
            
            const cart = window.cartManager.getCart();
            
            if (cart.length === 0) {
                container.innerHTML = '<p>No items in cart</p>';
                return;
            }
            
            const cartHTML = cart.map(item => `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <strong>${item.name}</strong><br>
                        <small>$${item.price} each</small>
                    </div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                        <button class="btn danger" onclick="removeItem('${item.id}')">Remove</button>
                    </div>
                    <div><strong>$${(item.price * item.quantity).toFixed(2)}</strong></div>
                </div>
            `).join('');
            
            container.innerHTML = cartHTML;
        }
        
        function updateQuantity(itemId, newQuantity) {
            if (window.cartManager) {
                window.cartManager.updateQuantity(itemId, newQuantity);
                updateStatusDisplay();
                updateCartDisplay();
            }
        }
        
        function removeItem(itemId) {
            if (window.cartManager) {
                window.cartManager.removeFromCart(itemId);
                updateStatusDisplay();
                updateCartDisplay();
            }
        }
        
        function testLogin() {
            if (window.authManager) {
                // Use demo login
                const demoUser = {
                    uid: 'demo-user-test',
                    email: 'demo@targstar.com',
                    displayName: 'Demo User'
                };
                
                window.authManager.currentUser = demoUser;
                localStorage.setItem('targstar_user', JSON.stringify(demoUser));
                
                showResult('firebase-results', 'Demo login successful', 'success');
                updateStatusDisplay();
                
                // Trigger sync
                setTimeout(() => {
                    if (window.cartManager) {
                        window.cartManager.syncWithFirebase();
                    }
                }, 1000);
            }
        }
        
        function testLogout() {
            if (window.authManager) {
                window.authManager.currentUser = null;
                localStorage.removeItem('targstar_user');
                
                showResult('firebase-results', 'Logged out successfully', 'success');
                updateStatusDisplay();
            }
        }
        
        // Auto-update status every 5 seconds
        setInterval(updateStatusDisplay, 5000);
        
        // Initial status update
        setTimeout(() => {
            updateStatusDisplay();
            updateCartDisplay();
            
            // Show initial status
            showResult('cart-results', 'Cart test page loaded successfully', 'success');
            
            if (window.SimpleFirebase?.isReady()) {
                showResult('firebase-results', 'Firebase is ready for testing', 'success');
            } else {
                showResult('firebase-results', 'Firebase not ready - using localStorage only', 'error');
            }
        }, 2000);
        
        console.log('üß™ Cart Firebase test page loaded');
    </script>
</body>
</html>